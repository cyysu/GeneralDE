<?xml version="1.0" encoding="GBK" standalone="yes"?>
<metalib tagsetversion="1" name="" version="1">
    <include name="svr_payment_data" file="svr_payment_data.xml"/>
    <include name="svr_payment_iap" file="svr_payment_iap.xml"/>
    <include name="svr_payment_gift" file="svr_payment_gift.xml"/>

    <!--  ============ 错误码定义 ======== -->
    <macrosgroup name="svr_payment_error">
        <macro name="SVR_PAYMENT_ERRNO_SUCCESS" value="0"/>
        <macro name="SVR_PAYMENT_ERRNO_INTERNAL" value="-1"/>
        <macro name="SVR_PAYMENT_ERRNO_DB" value="-2"/>
        <macro name="SVR_PAYMENT_ERRNO_RECHARGE_WAY_ERROR" value="1"/>
        <macro name="SVR_PAYMENT_ERRNO_BAG_ID_ERROR" value="2"/>
        <macro name="SVR_PAYMENT_ERRNO_MONEY_TYPE_ERROR" value="3"/>
        <macro name="SVR_PAYMENT_ERRNO_NOT_ENOUTH_MONEY" value="4"/>
        <macro name="SVR_PAYMENT_ERRNO_RECHARGE_IAP_ERROR" value="5"/>
        <macro name="SVR_PAYMENT_ERRNO_PRODUCT_NOT_EXIST" value="6"/>
        <macro name="SVR_PAYMENT_ERRNO_RECHARGE_PROCESSED" value="7"/>
        <macro name="SVR_PAYMENT_ERRNO_RECHARGE_TIMEOUT" value="8"/>
    </macrosgroup>

    <!--  ============ 协议定义 ========== -->
    
    <!--     充值 -->
    <macrosgroup name="svr_payment_recharge_way">
        <macro name="PAYMENT_RECHARGE_GIFT" value="1"/> <!-- 赠送 -->
        <macro name="PAYMENT_RECHARGE_IAP" value="2"/>  <!-- IAP充值 -->
    </macrosgroup>

    <union name="svr_payment_recharge_data" version="1">
        <entry name="gift" type="svr_payment_recharge_data_gift" id="PAYMENT_RECHARGE_GIFT"/>
        <entry name="iap" type="svr_payment_recharge_data_iap" id="PAYMENT_RECHARGE_IAP"/>
    </union>

    <struct name="svr_payment_req_recharge" version="1">
        <entry name="user_id" type="uint64" id="1"/>
        <entry name="bag_id" type="uint16" id="2"/>
        <entry name="way" type="uint16" id="3" bindmacrosgroup="svr_payment_recharge_way"/>
        <entry name="data" type="svr_payment_recharge_data" select="way" id="4"/>
        <entry name="reason" type="uint16" id="5"/>
    </struct>

    <struct name="svr_payment_res_recharge" version="1">
        <entry name="result" type="int16" id="1" bindmacrosgroup="svr_payment_recharge_result"/>
        <entry name="way_result" type="int16" id="2"/>
        <entry name="balance" type="svr_payment_money_group" id="3"/>
    </struct>

    <!--    查询 -->
    <struct name="svr_payment_req_get_balance" version="1">
        <entry name="user_id" type="uint64" id="1"/>
        <entry name="bag_id" type="uint16" id="2"/>
    </struct>

    <struct name="svr_payment_res_get_balance" version="1">
        <entry name="balance" type="svr_payment_money_group" id="1"/>
    </struct>

    <!--    支付 -->
    <struct name="svr_payment_req_pay" version="1">
        <entry name="user_id" type="uint64" id="1"/>
        <entry name="bag_id" type="uint16" id="2"/>
        <entry name="reason" type="uint16" id="3"/>
        <entry name="pay" type="svr_payment_money_group" id="4"/>
        <entry name="product_id" type="uint64" id="5"/>
    </struct>

    <struct name="svr_payment_res_pay" version="1">
        <entry name="result" type="int16" id="1" bindmacrosgroup="svr_payment_recharge_result"/>
        <entry name="balance" type="svr_payment_money_group" id="2"/>
    </struct>

    <!-- 错误响应 -->
    <struct name="svr_payment_res_error" version="1">
        <entry name="error" type="int16" id="1"/>
    </struct>

    <!--  =========== 整体协议定义 ========== -->
    <macrosgroup name="SVR_PAYMENT_CMD_ID">
        <macro name="SVR_PAYMENT_CMD_REQ_RECHARGE" value="1"/>
        <macro name="SVR_PAYMENT_CMD_RES_RECHARGE" value="2"/>

        <macro name="SVR_PAYMENT_CMD_REQ_GET_BALANCE" value="3"/>
        <macro name="SVR_PAYMENT_CMD_RES_GET_BALANCE" value="4"/>

        <macro name="SVR_PAYMENT_CMD_REQ_PAY" value="5"/>
        <macro name="SVR_PAYMENT_CMD_RES_PAY" value="6"/>

        <macro name="SVR_PAYMENT_CMD_RES_ERROR" value="7"/>
    </macrosgroup>

    <union name="svr_payment_pkg_data" version="1" desc="">
        <entry name="svr_payment_req_recharge" type="svr_payment_req_recharge" id="SVR_PAYMENT_CMD_REQ_RECHARGE"/>
        <entry name="svr_payment_res_recharge" type="svr_payment_res_recharge" id="SVR_PAYMENT_CMD_RES_RECHARGE"/>

        <entry name="svr_payment_req_get_balance" type="svr_payment_req_get_balance" id="SVR_PAYMENT_CMD_REQ_GET_BALANCE"/>
        <entry name="svr_payment_res_get_balance" type="svr_payment_res_get_balance" id="SVR_PAYMENT_CMD_RES_GET_BALANCE"/>

        <entry name="svr_payment_req_pay" type="svr_payment_req_pay" id="SVR_PAYMENT_CMD_REQ_PAY"/>
        <entry name="svr_payment_res_pay" type="svr_payment_res_pay" id="SVR_PAYMENT_CMD_RES_PAY"/>

        <entry name="svr_payment_res_error" type="svr_payment_res_error" id="SVR_PAYMENT_CMD_RES_ERROR"/>
    </union>

    <struct name="svr_payment_pkg" version="1">
        <entry name="cmd" type="uint32" id="1"/>
        <entry name="data" type="svr_payment_pkg_data" id="2" select="cmd"/>
    </struct>

</metalib>
